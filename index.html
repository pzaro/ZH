<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZARKOLIA Lab</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a237e">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3004/3004458.png">

    <style>
        /* --- Î“Î•ÎÎ™ÎšÎŸ Î£Î¤Î¥Î› (ÎŸÎ˜ÎŸÎÎ—) --- */
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f6; padding: 15px; color: #333; margin: 0; }
        
        /* Login */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a237e; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; }
        #loginBox { background: white; padding: 30px; border-radius: 15px; text-align: center; width: 80%; max-width: 300px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        #passwordInput { padding: 15px; font-size: 1.2em; width: 100%; box-sizing: border-box; margin-bottom: 15px; border: 2px solid #ddd; border-radius: 8px; text-align: center; -webkit-text-security: disc;}
        #loginBtn { background: #ff5722; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; }
        
        /* App Container */
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: none; }
        h1 { text-align: center; color: #1a237e; margin: 10px 0; font-size: 1.4em; }
        p.subtitle { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 20px; }
        
        .control-panel { background: #e8eaf6; padding: 20px; border-radius: 12px; border: 1px solid #c5cae9; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #3f51b5; }
        select, input[type="number"] { padding: 15px; font-size: 1.1em; border-radius: 10px; border: 2px solid #3f51b5; width: 100%; box-sizing: border-box; font-weight: bold; background: white; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 25px; }
        button { flex: 1; padding: 15px; font-size: 1em; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-calc { background-color: #3f51b5; color: white; }
        .btn-print { background-color: #546e7a; color: white; }

        .checkbox-group { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; align-items: center; background: white; padding: 10px; border-radius: 8px; }
        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; font-size: 1em; cursor: pointer; }
        input[type="checkbox"] { transform: scale(1.3); }

        /* Results */
        #resultContainer { margin-top: 30px; display: none; border: 1px solid #eee; border-radius: 10px; overflow: hidden; }
        .recipe-header { background-color: #263238; color: white; padding: 15px; }
        .recipe-title { font-size: 1.4em; font-weight: bold; display: block; }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; }
        th { background: #f5f5f5; }
        .phase-row td { background: #eceff1; color: #455a64; font-weight: bold; padding-top: 15px; }
        .amount-col { text-align: right; color: #2e7d32; font-weight: bold; }
        .total-row { background: #e8f5e9; font-weight: bold; color: #1b5e20; }
        
        .safety-box { background: #fff3e0; color: #bf360c; padding: 15px; border-left: 5px solid #ff5722; font-size: 0.9em; line-height: 1.4; }
        .instructions-box { background: #f1f8e9; color: #33691e; padding: 15px; border-top: 2px solid #aed581; }
        .instructions-list { padding-left: 20px; }
        .instructions-list li { margin-bottom: 8px; font-size: 0.95em; }

        /* --- LABEL PREVIEW (Visible only in Print Mode) --- */
        #labelPreview { 
            display: none; 
            /* Î¡ÏÎ¸Î¼Î¹ÏƒÎ· Î³Î¹Î± ÎŸÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± Î´Î¹Î¬Ï„Î±Î¾Î· */
            width: 100mm; height: 60mm; 
            margin: 20px auto; 
            box-sizing: border-box;
            background: white;
            font-family: Arial, sans-serif;
            border: 1px dashed #ccc; 
            padding: 2mm;
        }

        /* Flex container Î³Î¹Î± Î¿ÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± Î´Î¹Î¬Ï„Î±Î¾Î· */
        .lbl-container {
            display: flex;
            width: 100%;
            height: 100%;
            border: 2px solid black;
            border-radius: 5px;
            padding: 5px;
            box-sizing: border-box;
        }

        .lbl-left {
            flex: 1.5; /* Î Î¹Î¬Î½ÎµÎ¹ Ï„Î¿ 60% Ï„Î¿Ï… Ï€Î»Î¬Ï„Î¿Ï…Ï‚ */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding-right: 10px;
            border-right: 1px solid #ccc;
        }

        .lbl-right {
            flex: 1; /* Î Î¹Î¬Î½ÎµÎ¹ Ï„Î¿ 40% Ï„Î¿Ï… Ï€Î»Î¬Ï„Î¿Ï…Ï‚ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding-left: 10px;
        }

        .lbl-header { font-size: 9pt; font-weight: bold; text-transform: uppercase; color: #555; }
        .lbl-title { font-size: 18pt; font-weight: 900; line-height: 1.1; margin-top: 5px; }
        .lbl-meta { font-size: 8pt; margin-top: auto; color: #333; }
        
        .lbl-data-row { font-size: 10pt; font-weight: bold; margin: 4px 0; width: 100%; text-align: left;}
        .lbl-data-val { font-size: 12pt; display: block;}

        .pao-icon { width: 35px; height: 35px; margin-top: 10px; }

        /* --- PRINT SETTINGS --- */
        @media print {
            #loginOverlay, .control-panel, h1, .subtitle { display: none !important; }
            .container { box-shadow: none; margin: 0; padding: 0; width: 100%; max-width: none; }

            /* --- SCENARIO A: RECIPE (A4 PORTRAIT) --- */
            body:not(.print-label-mode) #resultContainer { 
                display: block; 
                width: 100%;
            }
            body:not(.print-label-mode) #labelPreview { display: none; }
            
            body:not(.print-label-mode) {
                background: white;
            }
            @page {
                size: A4 portrait;
                margin: 10mm;
            }

            /* --- SCENARIO B: LABEL (100mm x 62mm LANDSCAPE) --- */
            body.print-label-mode #resultContainer { display: none !important; }
            body.print-label-mode #labelPreview { 
                display: block !important; 
                position: fixed;
                top: 0; left: 0;
                width: 100mm;
                height: 62mm;
                border: none;
                margin: 0;
                padding: 0;
            }
            
            /* ÎšÏÎ¯ÏƒÎ¹Î¼Î· ÎµÎ½Ï„Î¿Î»Î® Î³Î¹Î± Brother: ÎŸÏÎ¯Î¶Î¿Ï…Î¼Îµ Î¼Î­Î³ÎµÎ¸Î¿Ï‚ Landscape */
            body.print-label-mode @page {
                size: 100mm 62mm; 
                margin: 0;
            }
        }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div id="loginBox">
        <h2 style="color:#1a237e; margin-top:0;">ZARKOLIA LAB</h2>
        <input type="password" id="passwordInput" placeholder="Password" inputmode="numeric">
        <button id="loginBtn" onclick="checkLogin()">Î•Î™Î£ÎŸÎ”ÎŸÎ£</button>
    </div>
</div>

<div class="container" id="mainApp">
    <h1>ZARKOLIA LAB</h1>
    <p class="subtitle">Production & Labeling v19</p>
    
    <div class="control-panel">
        <label>Î•Î Î™Î›ÎŸÎ“Î— Î Î¡ÎŸÎªÎŸÎÎ¤ÎŸÎ£</label>
        <select id="recipeSelect" onchange="toggleInputs()">
            <option value="" disabled selected>-- Î•Ï€Î¹Î»Î­Î¾Ï„Îµ --</option>
            <optgroup label="Î£Î¹ÏÏŒÏ€Î¹">
                <option value="syrup_custom">CUSTOM ALTHEA SYRUP</option>
            </optgroup>
            <optgroup label="ÎšÏÎ­Î¼ÎµÏ‚ Î ÏÎ¿ÏƒÏÏ€Î¿Ï…">
                <option value="plus">Revitacell Plus</option>
                <option value="eyes">Revitacell Eyes</option>
                <option value="hydralia">Hydralia Face</option>
            </optgroup>
            <optgroup label="Î˜ÎµÏÎ±Ï€ÎµÎ¯ÎµÏ‚ Î£ÏÎ¼Î±Ï„Î¿Ï‚">
                <option value="bruise">Bruise Off</option>
                <option value="zplast">Zplast Total Repair</option>
            </optgroup>
            <optgroup label="Î£Ï…Î¼Ï€Î»Î·ÏÏÎ¼Î±Ï„Î±">
                <option value="zboost">Z-Boost Caps</option>
            </optgroup>
            <optgroup label="Î’Î¬ÏƒÎµÎ¹Ï‚">
                <option value="base">Î’Î¬ÏƒÎ· Gel-Cream</option>
            </optgroup>
        </select>

        <div style="margin-top:15px;" id="standardInput">
            <label>Î£Î¤ÎŸÎ§ÎŸÎ£ Î Î‘Î¡Î‘Î“Î©Î“Î—Î£ (g)</label>
            <input type="number" id="totalWeightInput" value="1000" step="50">
        </div>

        <div style="margin-top:15px; display:none;" id="capsuleInput">
            <label>ÎšÎŸÎ¥Î¤Î™Î‘ (x30)</label>
            <input type="number" id="boxCount" value="10">
        </div>
        
        <div class="checkbox-group">
            <div class="checkbox-wrapper">
                <input type="checkbox" id="showInstructions" checked>
                <label for="showInstructions">ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®Ï‚ (A4)</label>
            </div>
            <div class="checkbox-wrapper" style="color:#d84315; font-weight:bold; border-top:1px solid #eee; padding-top:10px; width:100%; justify-content:center;">
                <input type="checkbox" id="printLabelMode" onchange="togglePrintMode()">
                <label for="printLabelMode">ğŸ–¨ï¸ Î•ÎšÎ¤Î¥Î Î©Î£Î— Î•Î¤Î™ÎšÎ•Î¤Î‘Î£ (ÎŸÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î±)</label>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn-calc" onclick="calculate()">Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£</button>
            <button class="btn-print" onclick="window.print()">Î•ÎšÎ¤Î¥Î Î©Î£Î—</button>
        </div>
    </div>

    <div id="labelPreview">
        <div class="lbl-container">
            <div class="lbl-left">
                <div>
                    <div class="lbl-header">ZARKOLIA LAB</div>
                    <div class="lbl-title" id="lblTitle">PRODUCT NAME</div>
                </div>
                <div class="lbl-meta">
                    Made in Greece<br>
                    Store in a cool dry place
                </div>
            </div>
            
            <div class="lbl-right">
                <div class="lbl-data-row">
                    LOT:<br><span class="lbl-data-val" id="lblLot">ZXX0000</span>
                </div>
                <div class="lbl-data-row">
                    EXP:<br><span class="lbl-data-val" id="lblExpDate">00/00</span>
                </div>
                <svg class="pao-icon" viewBox="0 0 100 100" fill="none" stroke="black" stroke-width="5">
                    <path d="M15,35 L15,85 Q15,95 25,95 L75,95 Q85,95 85,85 L85,35" fill="none" />
                    <path d="M85,35 L15,35 L10,15 Q50,5 90,15 Z" fill="none" />
                    <text x="50" y="75" text-anchor="middle" font-family="Arial" font-weight="bold" font-size="28" stroke="none" fill="black" id="paoText">6M</text>
                </svg>
            </div>
        </div>
    </div>

    <div id="resultContainer"></div>
</div>

<script>
    // --- SECURITY (Hash for 106014) ---
    const _0x9f2a = "34b35aca37baf7d5d997466dff1ab8ca1dc901df7010f3279138670838e2c9e8";

    async function checkLogin() {
        const input = document.getElementById('passwordInput').value;
        if (!input) return;
        const encoder = new TextEncoder();
        const data = encoder.encode(input);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        if (hashHex === _0x9f2a) {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
        } else {
            alert("Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚");
            document.getElementById('passwordInput').value = "";
        }
    }

    function togglePrintMode() {
        const isLabel = document.getElementById('printLabelMode').checked;
        if (isLabel) {
            document.body.classList.add('print-label-mode');
        } else {
            document.body.classList.remove('print-label-mode');
        }
    }

    // --- RECIPES ---
    const recipes = {
        plus: {
            title: "REVITACELL PLUS",
            desc: "New Formula",
            initials: "RP", 
            shelfLife: 12,
            type: "standard",
            safetyNote: "ÎˆÎ»Î±Î¹Î± ~10%. Î¤Î¿ Î’Î¬Î¼Î¼Î± ÎœÎ±ÏƒÏ„Î¯Ï‡Î±Ï‚ Î­Ï‡ÎµÎ¹ Î±Î»ÎºÎ¿ÏŒÎ»Î·.",
            ingredients: [
                { name: "Î’Î¬ÏƒÎ· Gel-Cream", pct: 0, isQS: true },
                { name: "Almond Oil", pct: 2.0 }, { name: "Avocado Oil", pct: 2.0 },
                { name: "Jojoba Oil", pct: 2.0 }, { name: "Pomegranate Oil", pct: 2.0 },
                { name: "Mastic Oil", pct: 1.0 }, { name: "Mastic Tincture", pct: 3.0 },
                { name: "Vit E", pct: 0.5 }
            ],
            instructions: ["1. Î‘Î½Î±Î¼ÎµÎ¯Î¾Ï„Îµ Î›Î¬Î´Î¹Î± & Î’Î¹Ï„.Î•.", "2. Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï„Î¿ Î’Î¬Î¼Î¼Î± ÏƒÏ„Î± Î»Î¬Î´Î¹Î± (Pre-mix).", "3. Î•Î½ÏƒÏ‰Î¼Î±Ï„ÏÏƒÏ„Îµ ÏƒÏ„Î· Î²Î¬ÏƒÎ·."]
        },
        syrup_custom: {
            title: "ALTHEA SYRUP",
            desc: "66.7%",
            initials: "AS",
            shelfLife: 6,
            type: "standard",
            safetyNote: "pH < 4.5. Î ÏÎ¿ÏƒÎ¿Ï‡Î® ÏƒÏ„Î·Î½ ÎºÏÏ…ÏƒÏ„Î¬Î»Î»Ï‰ÏƒÎ·.",
            ingredients: [
                { name: "Fructose", pct: 66.70 }, { name: "Aqua", pct: 0, isQS: true },
                { name: "Sodium Benzoate", pct: 0.10 }, { name: "--- MIX (5%) ---", isHeader: true },
                { name: "Althea/Thyme/Euc/Cran/Hipp", pct: 5.0 }, { name: "Vit C & Lemon EO", pct: 0.15 }, { name: "Lemon Juice", pct: 0, note: "q.s. pH" }
            ],
            instructions: ["1. Î–Î­ÏƒÏ„Î±Î¼Î± Î½ÎµÏÎ¿Ï.", "2. Î”Î¹Î¬Î»Ï…ÏƒÎ· Ï†ÏÎ¿Ï…ÎºÏ„ÏŒÎ¶Î·Ï‚.", "3. Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· <40C.", "4. pH < 4.5."]
        },
        eyes: {
            title: "REVITACELL EYES",
            desc: "Safe 8%",
            initials: "RE",
            shelfLife: 12,
            type: "standard",
            safetyNote: "ÎŒÏÎ¹Î¿ ÎµÎ»Î±Î¯Ï‰Î½ 10%.",
            ingredients: [
                { name: "Î’Î¬ÏƒÎ· Gel-Cream", pct: 0, isQS: true }, { name: "Arnica Oil", pct: 8.0 },
                { name: "Jojoba", pct: 1.0 }, { name: "Almond", pct: 1.0 },
                { name: "Hyaluronic 1%", pct: 4.0 }, { name: "Glycerin", pct: 2.0 },
                { name: "Hippocastanum", pct: 2.0 }, { name: "Parfum", pct: 0.2 }
            ],
            instructions: ["1. ÎœÎ¯Î¾Î· Î»Î±Î´Î¹ÏÎ½.", "2. Î•Î½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎ·."]
        },
        bruise: {
            title: "BRUISE OFF",
            desc: "Stearic",
            initials: "BO",
            shelfLife: 18,
            type: "standard",
            safetyNote: "Î¥Ï†Î® ÎºÎµÏÎ±Î»Î¿Î¹Ï†Î®Ï‚.",
            ingredients: [
                { name: "Phase A (Oils)", pct: 31.0 }, { name: "Phase B (Water)", pct: 0, isQS: true },
                { name: "Lavender", pct: 0.9 }
            ],
            instructions: ["1. Î˜Î­ÏÎ¼Î±Î½ÏƒÎ· 75C.", "2. ÎŸÎ¼Î¿Î³ÎµÎ½Î¿Ï€Î¿Î¯Î·ÏƒÎ·.", "3. ÎšÏÏÏ‰Î¼Î±."]
        },
        zboost: {
            title: "Z-BOOST CAPS",
            desc: "Ginger/ALA",
            initials: "ZB",
            shelfLife: 24,
            type: "capsule",
            capsuleContentWeight: 0.5864,
            safetyNote: "Dry Room.",
            ingredients: [{name:"Mix Powders", pct:100}],
            instructions: ["1. Î‘Î½Î¬Î¼ÎµÎ¹Î¾Î·.", "2. Î Î»Î®ÏÏ‰ÏƒÎ·."]
        },
        zplast: {
            title: "ZPLAST REPAIR",
            desc: "Total Repair",
            initials: "ZP",
            shelfLife: 12,
            type: "standard",
            ingredients: [
                { name: "Aqua", pct: 0, isQS: true }, { name: "Glycerin", pct: 4.0 }, { name: "Calamine", pct: 1.0 }, { name: "Starch", pct: 0.5 }, { name: "Hyaluronic", pct: 1.0 }, { name: "Citric", pct: 0.07 },
                { name: "Xalifin-15", pct: 5.0 }, { name: "Paraffin", pct: 7.5 }, { name: "Linum", pct: 2.5 }, { name: "Avocado", pct: 2.0 }, { name: "Cetostearyl", pct: 1.0 }, { name: "Vit E", pct: 0.5 },
                { name: "Hypericum", pct: 2.0 }, { name: "Hippophae", pct: 1.0 }, { name: "Centella", pct: 4.0 }, { name: "Mel", pct: 1.0 }, { name: "Mastic Oil", pct: 1.0 }, { name: "Euxyl PE", pct: 1.0 }, { name: "Alcohol", pct: 0.25 }, { name: "Parfum", pct: 0.07 }
            ],
            instructions: ["1. Î˜Î­ÏÎ¼Î±Î½ÏƒÎ· Î‘+Î’ 75C.", "2. ÎœÎ¯Î¾Î·.", "3. Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î“ <40C."]
        },
        hydralia: {
            title: "HYDRALIA FACE",
            desc: "Moisturizing",
            initials: "HF",
            shelfLife: 12,
            type: "standard",
            ingredients: [
                { name: "Î’Î¬ÏƒÎ· Gel-Cream", pct: 0, isQS: true }, { name: "Avocado", pct: 4.0 }, { name: "Jojoba", pct: 2.5 }, { name: "Almond", pct: 2.5 }, { name: "Aloe Gel", pct: 8.0 }, { name: "Parfum", pct: 0.3 }
            ],
            instructions: ["1. ÎœÎ¯Î¾Î· Î»Î±Î´Î¹ÏÎ½.", "2. Î•Î½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎ·."]
        },
        base: {
            title: "BASE GEL-CREAM",
            desc: "Base Formula",
            initials: "BG",
            shelfLife: 12,
            type: "standard",
            ingredients: [
                { name: "Aqua", pct: 0, isQS: true }, { name: "Glycerin", pct: 4.0 }, { name: "Hyaluronic Pw", pct: 0.2 }, { name: "Carbomer", pct: 0.25 }, { name: "Cetearyl", pct: 2.0 }, { name: "Stearic", pct: 1.0 }, { name: "IPM", pct: 2.0 }, { name: "Methyl P", pct: 0.2 }, { name: "Propyl P", pct: 0.1 }, { name: "Vit E", pct: 0.5 }, { name: "TEA", pct: 0.25 }
            ],
            instructions: ["1. Î•Î½Ï…Î´Î¬Ï„Ï‰ÏƒÎ· Carbomer.", "2. Î˜Î­ÏÎ¼Î±Î½ÏƒÎ· 75Â°C.", "3. Î•Î¾Î¿Ï…Î´ÎµÏ„Î­ÏÏ‰ÏƒÎ· Î¼Îµ TEA."]
        }
    };

    function toggleInputs() {
        const key = document.getElementById('recipeSelect').value;
        const isCap = recipes[key]?.type === 'capsule';
        document.getElementById('standardInput').style.display = isCap ? 'none' : 'block';
        document.getElementById('capsuleInput').style.display = isCap ? 'block' : 'none';
        document.getElementById('resultContainer').style.display = 'none';
    }

    function calculate() {
        const key = document.getElementById('recipeSelect').value;
        if (!key) return alert("Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï€ÏÎ¿ÏŠÏŒÎ½");
        const recipe = recipes[key];
        
        // --- CALC ---
        let weight = 0, info="";
        if (recipe.type === 'capsule') {
            const boxes = document.getElementById('boxCount').value;
            const perBox = document.getElementById('capsPerBox').value;
            weight = boxes * perBox * recipe.capsuleContentWeight;
            info = `${boxes} ÎºÎ¿Ï…Ï„Î¹Î¬ x ${perBox}`;
        } else {
            weight = parseFloat(document.getElementById('totalWeightInput').value);
            info = `${weight} g`;
        }
        if (!weight || weight <= 0) return alert("Î›Î¬Î¸Î¿Ï‚ Ï€Î¿ÏƒÏŒÏ„Î·Ï„Î±");

        // --- LABEL GENERATION (Z + INITIALS + MM + YYYY) ---
        const now = new Date();
        const exp = new Date();
        const shelfMonths = recipe.shelfLife || 12;
        exp.setMonth(exp.getMonth() + shelfMonths);
        
        const monthStr = String(now.getMonth() + 1).padStart(2, '0');
        const yearStr = now.getFullYear();
        const lotNo = "Z" + (recipe.initials || "XX") + monthStr + yearStr;
        const expStr = String(exp.getMonth() + 1).padStart(2, '0') + "/" + exp.getFullYear();

        document.getElementById('lblTitle').innerText = recipe.title;
        document.getElementById('lblLot').innerText = lotNo;
        document.getElementById('lblExpDate').innerText = expStr;
        document.getElementById('paoText').innerText = shelfMonths + "M";

        // --- TABLE RENDER (A4) ---
        let html = `
            <div class="recipe-header">
                <span class="recipe-title">${recipe.title}</span>
                <span style="display:block; font-size:0.9em; opacity:0.8">${recipe.desc}</span>
            </div>
            ${recipe.safetyNote ? `<div class="safety-box">âš ï¸ ${recipe.safetyNote}</div>` : ''}
            <div style="padding:10px; background:#e3f2fd; color:#0d47a1; font-weight:bold; text-align:center;">Î£Ï„ÏŒÏ‡Î¿Ï‚: ${info}</div>
            <table>
                <tr><th>Î£Î¥Î£Î¤Î‘Î¤Î™ÎšÎŸ</th><th style="text-align:right">Î ÎŸÎ£ÎŸÎ¤Î—Î¤Î‘</th></tr>
        `;

        let sumPct = 0;
        recipe.ingredients.forEach(i => { if(!i.isQS && !i.isHeader) sumPct += i.pct; });

        recipe.ingredients.forEach(i => {
            if (i.isHeader) {
                html += `<tr class="phase-row"><td colspan="2">${i.name}</td></tr>`;
            } else {
                let finalPct = i.isQS ? Math.max(0, 100 - sumPct) : i.pct;
                let amt = (finalPct / 100) * weight;
                html += `<tr><td>${i.name} ${i.note ? `<small>(${i.note})</small>`:''}</td><td class="amount-col">${amt.toFixed(2)} g</td></tr>`;
            }
        });

        html += `<tr class="total-row"><td>Î£Î¥ÎÎŸÎ›ÎŸ</td><td style="text-align:right">${weight.toFixed(1)} g</td></tr></table>`;

        if (document.getElementById('showInstructions').checked && recipe.instructions) {
            html += `<div class="instructions-box"><strong>ÎŸÎ”Î—Î“Î™Î•Î£:</strong><ul class="instructions-list">${recipe.instructions.map(s=>`<li>${s}</li>`).join('')}</ul></div>`;
        }

        const res = document.getElementById('resultContainer');
        res.innerHTML = html;
        res.style.display = 'block';
        
        togglePrintMode();
    }
</script>

</body>
</html>
