<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZARKOLIA Lab</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a237e">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3004/3004458.png">

    <style>
        /* --- Î“Î•ÎÎ™ÎšÎŸ Î£Î¤Î¥Î› --- */
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f6; padding: 15px; color: #333; margin: 0; }
        
        /* --- Login Screen --- */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a237e; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; }
        #loginBox { background: white; padding: 30px; border-radius: 15px; text-align: center; width: 80%; max-width: 300px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        #passwordInput { padding: 15px; font-size: 1.2em; width: 100%; box-sizing: border-box; margin-bottom: 15px; border: 2px solid #ddd; border-radius: 8px; text-align: center; -webkit-text-security: disc;}
        #loginBtn { background: #ff5722; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; }
        
        /* --- Main App --- */
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: none; }
        h1 { text-align: center; color: #1a237e; margin: 10px 0; font-size: 1.4em; }
        p.subtitle { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 20px; }
        
        .control-panel { background: #e8eaf6; padding: 20px; border-radius: 12px; border: 1px solid #c5cae9; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #3f51b5; }
        select, input[type="number"] { padding: 15px; font-size: 1.1em; border-radius: 10px; border: 2px solid #3f51b5; width: 100%; box-sizing: border-box; font-weight: bold; background: white; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 25px; }
        button { flex: 1; padding: 15px; font-size: 1em; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-calc { background-color: #3f51b5; color: white; }
        .btn-print { background-color: #546e7a; color: white; }

        /* --- Checkboxes --- */
        .checkbox-group { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; align-items: center; background: white; padding: 10px; border-radius: 8px; }
        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; font-size: 1em; cursor: pointer; }
        input[type="checkbox"] { transform: scale(1.3); }

        /* --- Result Table --- */
        #resultContainer { margin-top: 30px; display: none; border: 1px solid #eee; border-radius: 10px; overflow: hidden; }
        .recipe-header { background-color: #263238; color: white; padding: 15px; }
        .recipe-title { font-size: 1.2em; font-weight: bold; display: block; }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; }
        th { background: #f5f5f5; }
        .phase-row td { background: #eceff1; color: #455a64; font-weight: bold; padding-top: 15px; }
        .amount-col { text-align: right; color: #2e7d32; font-weight: bold; }
        .total-row { background: #e8f5e9; font-weight: bold; color: #1b5e20; }

        /* --- LABEL PREVIEW (Hidden on Screen) --- */
        #labelPreview { 
            display: none; 
            border: 1px dashed #333; 
            width: 62mm; height: 100mm; 
            margin: 20px auto; 
            padding: 2mm 5mm; 
            box-sizing: border-box;
            background: white;
            text-align: center;
            font-family: Arial, sans-serif;
        }

        /* --- PRINT SETTINGS --- */
        @media print {
            #loginOverlay, .control-panel, h1, .subtitle { display: none !important; }
            .container { box-shadow: none; margin: 0; padding: 0; width: 100%; max-width: none; }

            /* Default Print: A4 Report */
            #resultContainer { display: block; }
            #labelPreview { display: none; }

            /* Label Mode */
            body.print-label-mode #resultContainer { display: none !important; }
            body.print-label-mode #labelPreview { 
                display: flex !important; 
                flex-direction: column;
                justify-content: flex-start;
                align-items: center;
                position: absolute; 
                top: 0; left: 0;
            }
            
            body.print-label-mode { margin: 0; padding: 0; }
            @page {
                size: 62mm 100mm; 
                margin: 0;
            }
        }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div id="loginBox">
        <h2 style="color:#1a237e; margin-top:0;">ZARKOLIA LAB</h2>
        <input type="password" id="passwordInput" placeholder="Password">
        <button id="loginBtn" onclick="checkLogin()">Î•Î™Î£ÎŸÎ”ÎŸÎ£</button>
        <p id="errorMsg" style="color:red; display:none; margin-top:10px;">Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚</p>
    </div>
</div>

<div class="container" id="mainApp">
    <h1>ZARKOLIA LAB</h1>
    <p class="subtitle">Master Production Tool v16</p>
    
    <div class="control-panel">
        <label>Î•Î Î™Î›ÎŸÎ“Î— Î Î¡ÎŸÎªÎŸÎÎ¤ÎŸÎ£</label>
        <select id="recipeSelect" onchange="toggleInputs()">
            <option value="" disabled selected>-- Î•Ï€Î¹Î»Î­Î¾Ï„Îµ --</option>
            <optgroup label="Î£Î¹ÏÏŒÏ€Î¹">
                <option value="syrup_custom">CUSTOM ALTHEA SYRUP (66.7%)</option>
            </optgroup>
            <optgroup label="ÎšÏÎ­Î¼ÎµÏ‚ Î ÏÎ¿ÏƒÏÏ€Î¿Ï…">
                <option value="plus">Revitacell Plus (ÎÎ­Î± Î£ÏÎ½Î¸ÎµÏƒÎ·)</option>
                <option value="eyes">Revitacell Eyes (Safe 8% Arnica)</option>
                <option value="hydralia">Hydralia Face Cream</option>
            </optgroup>
            <optgroup label="Î˜ÎµÏÎ±Ï€ÎµÎ¯ÎµÏ‚ Î£ÏÎ¼Î±Ï„Î¿Ï‚">
                <option value="bruise">Bruise Off (ÎÎ­Î± Î¦ÏŒÏÎ¼Î¿Ï…Î»Î±)</option>
                <option value="zplast">Zplast Total Repair (ÎÎ­Î±)</option>
            </optgroup>
            <optgroup label="Î£Ï…Î¼Ï€Î»Î·ÏÏÎ¼Î±Ï„Î±">
                <option value="zboost">Z-Boost Caps</option>
            </optgroup>
            <optgroup label="Î’Î¬ÏƒÎµÎ¹Ï‚">
                <option value="base">Î’Î¬ÏƒÎ· Gel-Cream</option>
            </optgroup>
        </select>

        <div style="margin-top:15px;" id="standardInput">
            <label>Î£Î¤ÎŸÎ§ÎŸÎ£ Î Î‘Î¡Î‘Î“Î©Î“Î—Î£ (g)</label>
            <input type="number" id="totalWeightInput" value="1000" step="50">
        </div>

        <div style="margin-top:15px; display:none;" id="capsuleInput">
            <label>Î‘Î¡Î™Î˜ÎœÎŸÎ£ ÎšÎŸÎ¥Î¤Î™Î©Î</label>
            <input type="number" id="boxCount" value="10">
            <label style="margin-top:10px">Î¤Î•Îœ / ÎšÎŸÎ¥Î¤Î™</label>
            <select id="capsPerBox">
                <option value="12">12 caps</option>
                <option value="30" selected>30 caps</option>
            </select>
        </div>
        
        <div class="checkbox-group">
            <div class="checkbox-wrapper">
                <input type="checkbox" id="showInstructions" checked>
                <label for="showInstructions">ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®Ï‚</label>
            </div>
            <div class="checkbox-wrapper" style="color:#d84315; font-weight:bold; border-top:1px solid #eee; padding-top:10px; width:100%; justify-content:center;">
                <input type="checkbox" id="printLabelMode" onchange="togglePrintMode()">
                <label for="printLabelMode">ğŸ–¨ï¸ Î•Ï„Î¹ÎºÎ­Ï„Î± Brother (62x100)</label>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn-calc" onclick="calculate()">Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£</button>
            <button class="btn-print" onclick="window.print()">Î•ÎšÎ¤Î¥Î Î©Î£Î—</button>
        </div>
    </div>

    <div id="labelPreview">
        <div style="font-weight:bold; font-size:11pt; border-bottom:2px solid black; width:100%; padding-bottom:3px; margin-bottom:10px;">ZARKOLIA LAB</div>
        
        <div id="lblTitle" style="font-size:14pt; font-weight:900; margin-bottom:10px; line-height:1.1; word-wrap: break-word;">PRODUCT TITLE</div>
        
        <div style="border:1px solid #333; padding:5px; margin:10px 0; width:90%;">
            <div style="text-align:left; font-size:9pt;">
                <strong>Prod:</strong> <span id="lblProdDate">--/--/----</span>
            </div>
            <div style="text-align:left; font-size:9pt; margin-top:3px;">
                <strong>Exp:</strong> <span id="lblExpDate">--/--/----</span>
            </div>
        </div>
        
        <div style="font-size:12pt; font-weight:bold; margin-top:5px;">
            BATCH: <span id="lblBatch">AUTO</span>
        </div>
        
        <div style="margin-top:auto; font-size:7pt; color:#555; padding-top:10px;">
            Store in a cool dry place<br>Made in Greece
        </div>
    </div>

    <div id="resultContainer"></div>
</div>

<script>
    // --- SECURITY (Hash for Zarkolialab2026@#!) ---
    const _0x9f2a = "54e36ecfb4491012abb5b6b66a485b41fd2fe30a6899e7ddc4c9ded7f7caee2e";

    async function checkLogin() {
        const input = document.getElementById('passwordInput').value;
        if (!input) return;
        const encoder = new TextEncoder();
        const data = encoder.encode(input);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        if (hashHex === _0x9f2a) {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
        } else {
            alert("Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚");
            document.getElementById('passwordInput').value = "";
        }
    }

    function togglePrintMode() {
        const isLabel = document.getElementById('printLabelMode').checked;
        if (isLabel) {
            document.body.classList.add('print-label-mode');
        } else {
            document.body.classList.remove('print-label-mode');
        }
    }

    // --- FULL RECIPE DATABASE ---
    const recipes = {
        plus: {
            title: "REVITACELL PLUS (New)",
            desc: "Î‘Î½Ï„Î¹Î³Î®ÏÎ±Î½ÏƒÎ· Î¼Îµ ÎœÎ±ÏƒÏ„Î¯Ï‡Î± & Î¡ÏŒÎ´Î¹",
            type: "standard",
            shelfLife: 12, 
            safetyNote: "ÎˆÎ»Î±Î¹Î± ~10%. Î¤Î¿ Î’Î¬Î¼Î¼Î± ÎœÎ±ÏƒÏ„Î¯Ï‡Î±Ï‚ Î­Ï‡ÎµÎ¹ Î±Î»ÎºÎ¿ÏŒÎ»Î· - Ï€ÏÎ¿ÏƒÎ¿Ï‡Î® ÏƒÏ„Î·Î½ Î±ÏÎ±Î¯Ï‰ÏƒÎ·.",
            ingredients: [
                { name: "Î’Î¬ÏƒÎ· Gel-Cream", pct: 0, isQS: true },
                { name: "Almond Oil", pct: 2.0 }, { name: "Avocado Oil", pct: 2.0 },
                { name: "Jojoba Oil", pct: 2.0 }, { name: "Pomegranate Oil", pct: 2.0 },
                { name: "Mastic Oil", pct: 1.0 }, { name: "Mastic Tincture", pct: 3.0 },
                { name: "Vit E", pct: 0.5 }
            ],
            instructions: ["1. Î‘Î½Î±Î¼ÎµÎ¯Î¾Ï„Îµ Î›Î¬Î´Î¹Î± & Î’Î¹Ï„.Î•.", "2. Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï„Î¿ Î’Î¬Î¼Î¼Î± ÏƒÏ„Î± Î»Î¬Î´Î¹Î± (Pre-mix).", "3. Î¡Î¯Î¾Ï„Îµ Ï„Î¿ Î¼Î¯Î³Î¼Î± ÏƒÏ„Î· Î’Î¬ÏƒÎ· ÏƒÏ„Î±Î´Î¹Î±ÎºÎ¬."]
        },
        syrup_custom: {
            title: "CUSTOM ALTHEA SYRUP",
            desc: "Î Ï…ÎºÎ½ÏŒ Î£Î¹ÏÏŒÏ€Î¹ (66.7%)",
            type: "standard",
            shelfLife: 6,
            safetyNote: "Î‘Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ pH < 4.5 Î³Î¹Î± Ï„Î¿ Sodium Benzoate. Î ÏÎ¿ÏƒÎ¿Ï‡Î® ÏƒÏ„Î·Î½ ÎºÏÏ…ÏƒÏ„Î¬Î»Î»Ï‰ÏƒÎ·.",
            ingredients: [
                { name: "Fructose", pct: 66.70 }, { name: "Aqua", pct: 0, isQS: true },
                { name: "--- Î’Î‘ÎœÎœÎ‘Î¤Î‘ (5%) ---", isHeader: true },
                { name: "Î‘Î»Î¸Î±Î¯Î±", pct: 2.10 }, { name: "Î˜Ï…Î¼Î¬ÏÎ¹", pct: 0.79 },
                { name: "Î•Ï…ÎºÎ¬Î»Ï…Ï€Ï„Î¿Ï‚", pct: 0.79 }, { name: "ÎšÏÎ¬Î½Î¹", pct: 0.79 }, { name: "Î™Ï€Ï€Î¿Ï†Î±Î­Ï‚", pct: 0.79 },
                { name: "Sodium Benzoate", pct: 0.10 }, { name: "Vit C", pct: 0.10 },
                { name: "Lemon EO", pct: 0.05 }, { name: "Î§Ï…Î¼ÏŒÏ‚ Î›ÎµÎ¼Î¿Î½Î¹Î¿Ï", pct: 0, note: "q.s. pH" }
            ],
            instructions: ["1. Î–ÎµÏƒÏ„Î¬Î½ÎµÏ„Îµ ÎÎµÏÏŒ + Î›ÎµÎ¼ÏŒÎ½Î¹ (60-70Â°C).", "2. Î”Î¹Î±Î»ÏÏƒÏ„Îµ Ï„Î· Î¦ÏÎ¿Ï…ÎºÏ„ÏŒÎ¶Î· Ï€Î»Î®ÏÏ‰Ï‚.", "3. ÎšÏÏ…ÏÏƒÏ„Îµ ÏƒÏ„Î¿Ï…Ï‚ 40Â°C.", "4. Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î±.", "5. Î•Î»Î­Î³Î¾Ï„Îµ pH < 4.5."]
        },
        eyes: {
            title: "REVITACELL EYES (Safe)",
            desc: "8% Î†ÏÎ½Î¹ÎºÎ±",
            type: "standard",
            shelfLife: 12,
            safetyNote: "ÎŒÏÎ¹Î¿ ÎµÎ»Î±Î¯Ï‰Î½ 10%.",
            ingredients: [
                { name: "Î’Î¬ÏƒÎ· Gel-Cream", pct: 0, isQS: true }, { name: "Arnica Oil", pct: 8.0 },
                { name: "Jojoba", pct: 1.0 }, { name: "Almond", pct: 1.0 },
                { name: "Hyaluronic 1%", pct: 4.0 }, { name: "Glycerin", pct: 2.0 },
                { name: "Hippocastanum", pct: 2.0 }, { name: "Parfum", pct: 0.2 }
            ],
            instructions: ["1. ÎœÎ¯Î¾Î· Î»Î±Î´Î¹ÏÎ½ Î¾ÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„Î¬.", "2. Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï…Î´Î±Ï„Î¹ÎºÏÎ½ ÏƒÏ„Î¿ Î»Î¬Î´Î¹.", "3. Î•Î½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎ· ÏƒÏ„Î· Î²Î¬ÏƒÎ·."]
        },
        bruise: {
            title: "BRUISE OFF CREAM",
            desc: "Stearic Formula",
            type: "standard",
            shelfLife: 18,
            safetyNote: "Î¥Ï†Î® ÎºÎµÏÎ±Î»Î¿Î¹Ï†Î®Ï‚. Î“Î¹Î± Î»ÎµÏÎºÎ±Î½ÏƒÎ·: +0.5% TEA.",
            ingredients: [
                { name: "--- PHASE A ---", isHeader: true }, { name: "Arnica Oil", pct: 9.10 }, { name: "Vaseline", pct: 9.10 }, { name: "Cetostearyl", pct: 7.70 }, { name: "Stearic Acid", pct: 3.30 }, { name: "Linseed Oil", pct: 1.80 }, { name: "Propyl Paraben", pct: 0.10 },
                { name: "--- PHASE B ---", isHeader: true }, { name: "Aqua", pct: 0, isQS: true }, { name: "Poly 80", pct: 3.70 }, { name: "PG", pct: 1.80 }, { name: "Methyl Paraben", pct: 0.10 },
                { name: "--- PHASE C ---", isHeader: true }, { name: "Lavender", pct: 0.90 }
            ],
            instructions: ["1. Î›Î¹ÏÏƒÎ¹Î¼Î¿ Î¦Î¬ÏƒÎ·Ï‚ Î‘ ÎºÎ±Î¹ Î’ ÏƒÏ„Î¿Ï…Ï‚ 75Â°C.", "2. ÎœÎ¯Î¾Î· Î‘ ÏƒÎµ Î’.", "3. Î‘Î½Î¬Î´ÎµÏ…ÏƒÎ· Î¼Î­Ï‡ÏÎ¹ Î½Î± ÎºÏÏ…ÏÏƒÎµÎ¹.", "4. Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î±ÏÏÎ¼Î±Ï„Î¿Ï‚."]
        },
        zboost: {
            title: "Z-BOOST CAPS",
            desc: "Ginger/ALA",
            type: "capsule",
            shelfLife: 24,
            capsuleContentWeight: 0.5864,
            safetyNote: "Î•Ï…Î±Î¹ÏƒÎ¸Î·Ï„Î¿ ÏƒÏ„Î·Î½ Ï…Î³ÏÎ±ÏƒÎ¯Î±. Dry Room.",
            ingredients: [
                { name: "ALA", pct: 34.11 }, { name: "NAC", pct: 34.11 }, { name: "Ginger Ext", pct: 17.05 },
                { name: "Q10", pct: 8.53 }, { name: "Zinc Gluc", pct: 5.97 }, { name: "Mg Stearate", pct: 0.19 },
                { name: "Se Yeast", pct: 0.03 }, { name: "Na Ascorbate", pct: 0.02 }
            ],
            instructions: ["1. Î“ÎµÏ‰Î¼ÎµÏ„ÏÎ¹ÎºÎ® Î±ÏÎ±Î¯Ï‰ÏƒÎ· Î¼Î¹ÎºÏÎ¿-ÏƒÏ…ÏƒÏ„Î±Ï„Î¹ÎºÏÎ½.", "2. Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ALA, NAC.", "3. Î¤Î­Î»Î¿Ï‚ Mg Stearate (Î±Ï€Î±Î»Î® Î¼Î¯Î¾Î·).", "4. Î Î»Î®ÏÏ‰ÏƒÎ·."]
        },
        zplast: {
            title: "ZPLAST TOTAL REPAIR",
            desc: "ÎÎ­Î± Î¦ÏŒÏÎ¼Î¿Ï…Î»Î±",
            type: "standard",
            shelfLife: 12,
            ingredients: [
                { name: "--- PHASE A ---", isHeader: true }, { name: "Aqua", pct: 0, isQS: true }, { name: "Glycerin", pct: 4.0 }, { name: "Calamine", pct: 1.0 }, { name: "Starch", pct: 0.5 }, { name: "Hyaluronic", pct: 1.0 }, { name: "Citric", pct: 0.07 },
                { name: "--- PHASE B ---", isHeader: true }, { name: "Xalifin-15", pct: 5.0 }, { name: "Paraffin", pct: 7.5 }, { name: "Linum", pct: 2.5 }, { name: "Avocado", pct: 2.0 }, { name: "Cetostearyl", pct: 1.0 }, { name: "Vit E", pct: 0.5 },
                { name: "--- PHASE C ---", isHeader: true }, { name: "Hypericum", pct: 2.0 }, { name: "Hippophae", pct: 1.0 }, { name: "Centella", pct: 4.0 }, { name: "Mel", pct: 1.0 }, { name: "Mastic Oil", pct: 1.0 }, { name: "Euxyl PE", pct: 1.0 }, { name: "Alcohol", pct: 0.25 }, { name: "Parfum", pct: 0.07 }
            ],
            instructions: ["1. Î˜Î­ÏÎ¼Î±Î½ÏƒÎ· Î‘ & Î’ ÏƒÏ„Î¿Ï…Ï‚ 75Â°C.", "2. ÎœÎ¯Î¾Î· Î’ ÏƒÎµ Î‘.", "3. Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î“ < 40Â°C."]
        },
        hydralia: {
            title: "HYDRALIA FACE",
            desc: "Î•Î½Ï…Î´Î±Ï„Î¹ÎºÎ®",
            type: "standard",
            shelfLife: 12,
            ingredients: [
                { name: "Î’Î¬ÏƒÎ· Gel-Cream", pct: 0, isQS: true }, { name: "Avocado", pct: 4.0 }, { name: "Jojoba", pct: 2.5 }, { name: "Almond", pct: 2.5 }, { name: "Aloe Gel", pct: 8.0 }, { name: "Parfum", pct: 0.3 }
            ],
            instructions: ["1. ÎœÎ¯Î¾Î· Î»Î±Î´Î¹ÏÎ½.", "2. Î•Î½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎ· ÏƒÏ„Î· Î²Î¬ÏƒÎ·."]
        },
        base: {
            title: "Î’Î‘Î£Î— GEL-CREAM",
            desc: "Base Formula",
            type: "standard",
            shelfLife: 12,
            ingredients: [
                { name: "Aqua", pct: 0, isQS: true }, { name: "Glycerin", pct: 4.0 }, { name: "Hyaluronic Pw", pct: 0.2 }, { name: "Carbomer", pct: 0.25 }, { name: "Cetearyl", pct: 2.0 }, { name: "Stearic", pct: 1.0 }, { name: "IPM", pct: 2.0 }, { name: "Methyl P", pct: 0.2 }, { name: "Propyl P", pct: 0.1 }, { name: "Vit E", pct: 0.5 }, { name: "TEA", pct: 0.25 }
            ],
            instructions: ["1. Î•Î½Ï…Î´Î¬Ï„Ï‰ÏƒÎ· Carbomer.", "2. Î˜Î­ÏÎ¼Î±Î½ÏƒÎ· 75Â°C.", "3. Î•Î¾Î¿Ï…Î´ÎµÏ„Î­ÏÏ‰ÏƒÎ· Î¼Îµ TEA."]
        }
    };

    function toggleInputs() {
        const key = document.getElementById('recipeSelect').value;
        const isCap = recipes[key]?.type === 'capsule';
        document.getElementById('standardInput').style.display = isCap ? 'none' : 'block';
        document.getElementById('capsuleInput').style.display = isCap ? 'block' : 'none';
        document.getElementById('resultContainer').style.display = 'none';
    }

    function calculate() {
        const key = document.getElementById('recipeSelect').value;
        if (!key) return alert("Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï€ÏÎ¿ÏŠÏŒÎ½");
        
        const recipe = recipes[key];
        const isCap = recipe.type === 'capsule';
        let weight = 0, info = "";

        // --- CALCULATION LOGIC ---
        if (isCap) {
            const boxes = document.getElementById('boxCount').value;
            const perBox = document.getElementById('capsPerBox').value;
            weight = boxes * perBox * recipe.capsuleContentWeight;
            info = `${boxes} ÎºÎ¿Ï…Ï„Î¹Î¬ x ${perBox} Ï„Î¼Ï‡`;
        } else {
            weight = parseFloat(document.getElementById('totalWeightInput').value);
            info = `${weight} g`;
        }
        if (!weight || weight <= 0) return alert("Î›Î¬Î¸Î¿Ï‚ Ï€Î¿ÏƒÏŒÏ„Î·Ï„Î±");

        // --- LABEL DATA POPULATION ---
        const now = new Date();
        const exp = new Date();
        const shelfMonths = recipe.shelfLife || 12; 
        exp.setMonth(exp.getMonth() + shelfMonths);
        const formatDate = (d) => `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;
        
        document.getElementById('lblTitle').innerText = recipe.title;
        document.getElementById('lblProdDate').innerText = formatDate(now);
        document.getElementById('lblExpDate').innerText = formatDate(exp);
        document.getElementById('lblBatch').innerText = now.getFullYear().toString().substr(-2) + String(now.getMonth()+1).padStart(2,'0') + String(now.getDate()).padStart(2,'0') + "-" + key.toUpperCase().substr(0,3);

        // --- TABLE GENERATION ---
        let html = `
            <div class="recipe-header">
                <span class="recipe-title">${recipe.title}</span>
                <span style="display:block; font-size:0.9em; opacity:0.8">${recipe.desc}</span>
            </div>
            ${recipe.safetyNote ? `<div class="safety-box">âš ï¸ ${recipe.safetyNote}</div>` : ''}
            <div style="padding:10px; background:#e3f2fd; color:#0d47a1; font-weight:bold; text-align:center;">Î£Ï„ÏŒÏ‡Î¿Ï‚: ${info}</div>
            <table>
                <tr><th>Î£Î¥Î£Î¤Î‘Î¤Î™ÎšÎŸ</th><th style="text-align:right">Î ÎŸÎ£ÎŸÎ¤Î—Î¤Î‘</th></tr>
        `;

        let sumPct = 0;
        recipe.ingredients.forEach(i => { if(!i.isQS && !i.isHeader) sumPct += i.pct; });

        recipe.ingredients.forEach(i => {
            if (i.isHeader) {
                html += `<tr class="phase-row"><td colspan="2">${i.name}</td></tr>`;
            } else {
                let finalPct = i.isQS ? Math.max(0, 100 - sumPct) : i.pct;
                let amt = (finalPct / 100) * weight;
                html += `<tr><td>${i.name} ${i.note ? `<small>(${i.note})</small>`:''}</td><td class="amount-col">${amt.toFixed(2)} g</td></tr>`;
            }
        });

        html += `<tr class="total-row"><td>Î£Î¥ÎÎŸÎ›ÎŸ</td><td style="text-align:right">${weight.toFixed(1)} g</td></tr></table>`;

        if (document.getElementById('showInstructions').checked && recipe.instructions) {
            html += `<div class="instructions-box"><strong>ÎŸÎ”Î—Î“Î™Î•Î£:</strong><ul class="instructions-list">${recipe.instructions.map(s=>`<li>${s}</li>`).join('')}</ul></div>`;
        }

        const res = document.getElementById('resultContainer');
        res.innerHTML = html;
        res.style.display = 'block';
        
        // Sync Print Mode
        togglePrintMode();
    }
</script>

</body>
</html>
